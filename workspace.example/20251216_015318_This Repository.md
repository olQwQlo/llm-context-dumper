===== BEGIN FILE: DUMP_META =====
file_tree=FILE_TREE
file_block=BEGIN/END
begin_pattern="===== BEGIN FILE: {path} | lang={lang} ====="
end_pattern="===== END FILE: {path} ====="
redaction_notice="Files may be omitted or redacted; see inline placeholders."
===== END FILE: DUMP_META =====

===== BEGIN FILE: FILE_TREE =====
llm-context-dumper
├─ .git/ [DIR:本文非表示]
├─ workspace/ [DIR:本文非表示]
├─ workspace.example/
│  ├─ BatchDump.ps1
│  └─ workspace.json
├─ .gitignore
├─ LICENSE
├─ README.md
├─ RepoDump.json [FILE:本文非表示]
├─ RepoDump.json.example
└─ RepoDump.ps1
===== END FILE: FILE_TREE =====

===== BEGIN FILE: .gitignore | lang=text =====
RepoDump.json
# Output file
dump.md

workspace/
===== END FILE: .gitignore =====

===== BEGIN FILE: LICENSE | lang=text =====
MIT License

Copyright (c) 2025 olOwOlo

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
===== END FILE: LICENSE =====

===== BEGIN FILE: README.md | lang=markdown =====
# repo-to-markdown-ps 📄➡️📦

A high-performance PowerShell script that converts an entire project directory into a single Markdown file.
Designed to create **context for LLMs** (ChatGPT, Claude, Gemini, etc.).

## ✨ Features

- **🌲 Visual File Tree**: Generates a clear directory structure at the top.
- **🚫 Smart Filtering**:
  - Respects `.gitignore` (optional).
  - Automatically hides `node_modules`, `.git`, binaries, and build artifacts.
  - **Security Redaction**: Hides contents of secrets (`.env`, private keys) while keeping the file structure.
- **🚀 High Performance**: Supports parallel reading (`-ParallelRead`) for large repositories using PowerShell 7+.
- **📝 Markdown Output**: Code blocks are properly formatted with language extensions for syntax highlighting.

## 🚀 Usage

Download `RepoDump.ps1` and run it in your terminal.

### Setup (Optional)

To customize exclusion rules and redaction patterns, copy `RepoDump.json.example` to `RepoDump.json`:

```powershell
Copy-Item RepoDump.json.example RepoDump.json
```

### Basic Usage

```powershell
./RepoDump.ps1 -RootPath "C:\Projects\MyApp"
```

This generates `dump.md` in the current directory.

### Advanced Usage

```powershell
./RepoDump.ps1 `
  -RootPath "C:\Projects\MyApp" `
  -OutPath "./context.md" `
  -UseGitignore `
  -ParallelRead `
  -ShowProgress
```

## 📦 Batch Dump Tool

For managing multiple context dumps (e.g., separating "Whole Project", "Backend", "Frontend"), use the batch tool provided in the `workspace.example` directory.

### Setup

1. Copy the example workspace to create your own working environment:
   ```powershell
   Copy-Item -Recurse workspace.example workspace
   ```
   The `workspace` directory is ignored by git, providing a clean sandbox for your dumps.

2. Edit `workspace/workspace.json` to define your targets. Paths are relative to the project root.
   ```json
   {
     "Targets": [
       { "Name": "WholeProject", "Path": "." },
       { "Name": "Backend", "Path": "backend" }
     ]
   }
   ```

### Usage

```powershell
cd workspace
./BatchDump.ps1
```

This will generate timestamped markdown files (e.g., `20251216_120000_WholeProject.md`) inside the `workspace` directory.

## ⚙️ Parameters

| Parameter | Description | Default |
| :--- | :--- | :--- |
| `-RootPath` | Target directory path (Required). | - |
| `-OutPath` | Output file path. | `./dump.md` |
| `-UseGitignore` | Use `.gitignore` to exclude files. | `false` |
| `-ParallelRead` | Enable parallel processing (Requires PS 7+). | `false` |
| `-ThrottleLimit` | Concurrency limit for parallel reading. | `4` |
| `-ShowProgress` | Show progress bar during processing. | `false` |
| `-CsvPreviewLines` | Number of lines to preview for CSV files. | `5` |
| `-ConfigFile` | Path to a custom configuration JSON file. | `RepoDump.json` |
| `-MaxFileSizeMB` | Skip files larger than this size. | `5` (MB) |

## 🛡️ Security Note

This script attempts to redact sensitive files (like `.env`, `id_rsa`, `*.pem`) by default. However, **always review the output file** before uploading it to any third-party AI service to ensure no secrets are leaked.

## 📄 License

MIT License
===== END FILE: README.md =====

===== BEGIN FILE: RepoDump.json | lang=redacted =====
[REDACTED: Hidden file (build artifact, binary, etc.)]
===== END FILE: RepoDump.json =====

===== BEGIN FILE: RepoDump.json.example | lang=text =====
{
  "HideDirNames": [
    ".git",
    ".svn",
    ".hg",
    "node_modules",
    "bower_components",
    "vendor",
    "dist",
    "build",
    "out",
    ".next",
    ".nuxt",
    ".svelte-kit",
    ".turbo",
    ".cache",
    ".parcel-cache",
    "coverage",
    ".nyc_output",
    "bin",
    "obj",
    "target",
    ".venv",
    "venv",
    "__pycache__",
    ".pytest_cache",
    ".mypy_cache",
    ".ruff_cache",
    ".gradle",
    ".idea",
    ".vscode",
    ".terraform",
    ".terragrunt-cache"
  ],
  "HideFilePatterns": [
    "*.exe",
    "*.dll",
    "*.so",
    "*.dylib",
    "*.a",
    "*.lib",
    "*.pdb",
    "*.obj",
    "*.o",
    "*.class",
    "*.jar",
    "*.war",
    "*.png",
    "*.jpg",
    "*.jpeg",
    "*.gif",
    "*.webp",
    "*.ico",
    "*.svg",
    "*.mp4",
    "*.mov",
    "*.mkv",
    "*.avi",
    "*.mp3",
    "*.wav",
    "*.flac",
    "*.zip",
    "*.7z",
    "*.rar",
    "*.tar",
    "*.gz",
    "*.bz2",
    "*.xz",
    "*.pdf",
    "*.doc",
    "*.docx",
    "*.ppt",
    "*.pptx",
    "*.xls",
    "*.xlsx",
    "*.ttf",
    "*.otf",
    "*.woff",
    "*.woff2",
    "*.db",
    "*.sqlite",
    "*.sqlite3",
    "*.log",
    "package-lock.json",
    "yarn.lock",
    "pnpm-lock.yaml"
  ],
  "RedactFilePatterns": [
    ".env",
    "*.env",
    ".env.*",
    "*.pem",
    "*.key",
    "*.pfx",
    "*.p12",
    "*.kdbx",
    "id_rsa",
    "id_ed25519",
    "known_hosts",
    ".npmrc",
    ".pypirc",
    ".dockerconfigjson"
  ],
  "RedactDirNames": [
    ".aws",
    ".ssh",
    ".gnupg"
  ],
  "AllowEnvNames": [
    ".env.sample",
    ".env.example",
    ".env.template"
  ]
}
===== END FILE: RepoDump.json.example =====

===== BEGIN FILE: .git/ | lang=redacted =====
[REDACTED: Directory content hidden (existence only)]
===== END FILE: .git/ =====

===== BEGIN FILE: workspace/ | lang=redacted =====
[REDACTED: Directory content hidden (existence only)]
===== END FILE: workspace/ =====

===== BEGIN FILE: workspace.example/BatchDump.ps1 | lang=powershell =====
<#
.SYNOPSIS
BatchDump.ps1 - 複数のディレクトリをまとめてダンプするラッパースクリプト

.DESCRIPTION
workspace.json (または指定された設定ファイル) に定義されたターゲットリストに基づいて、
RepoDump.ps1 を順次実行し、Markdownファイルを一括生成します。

.EXAMPLE
.\BatchDump.ps1

.EXAMPLE
.\BatchDump.ps1 -ConfigFile "MyConfig.json" -OutDir ".\output"
#>

param(
    [string]$ConfigFile = "workspace.json",
    [string]$OutDir = ".",
    [string]$RepoDumpScript = "..\RepoDump.ps1",
    [switch]$Force
)

$ErrorActionPreference = "Stop"
Set-StrictMode -Version Latest

# -------------------------------------------------------------
# ユーティリティ関数
# -------------------------------------------------------------
function Write-Log([string]$msg, [string]$color = "White") {
    $ts = Get-Date -Format "HH:mm:ss"
    Write-Host "[$ts] $msg" -ForegroundColor $color
}

# -------------------------------------------------------------
# 準備
# -------------------------------------------------------------
$scriptRoot = $PSScriptRoot
if (-not $scriptRoot) { $scriptRoot = (Get-Location).Path }

# 親ディレクトリ（プロジェクトルート）
$projectRoot = Split-Path -Parent $scriptRoot

$configPath = Resolve-Path -Path $ConfigFile -ErrorAction SilentlyContinue
if (-not $configPath) {
    Write-Error "Configuration file not found: $ConfigFile"
    exit 1
}

$repoDumpPath = Resolve-Path -Path $RepoDumpScript -ErrorAction SilentlyContinue
if (-not $repoDumpPath) {
    Write-Error "RepoDump script not found: $RepoDumpScript"
    exit 1
}

# 出力ディレクトリ作成
if (-not (Test-Path -LiteralPath $OutDir)) {
    New-Item -ItemType Directory -Path $OutDir -Force | Out-Null
    Write-Log "Created output directory: $OutDir" "Cyan"
}

# 設定読み込み
try {
    $json = Get-Content -LiteralPath $configPath -Raw -Encoding UTF8 | ConvertFrom-Json
    $targets = $json.Targets
}
catch {
    Write-Error "Failed to parse JSON config: $_"
    exit 1
}

if (-not $targets) {
    Write-Warning "No targets found in configuration."
    exit 0
}

Write-Log "Loaded configuration from $($configPath.Path)" "Green"
Write-Log "Found $($targets.Count) targets." "Green"

# -------------------------------------------------------------
# メイン処理
# -------------------------------------------------------------
$timestamp = Get-Date -Format "yyyyMMdd_HHmmss"
$successCount = 0
$failCount = 0

foreach ($t in $targets) {
    $name = $t.Name
    $relPath = $t.Path

    if ([string]::IsNullOrWhiteSpace($name) -or [string]::IsNullOrWhiteSpace($relPath)) {
        Write-Warning "Skipping invalid target entry: Name='$name', Path='$relPath'"
        continue
    }

    # パス解決（プロジェクトルート基準）
    $targetFullPath = $null
    if (Split-Path $relPath -IsAbsolute) {
        $targetFullPath = $relPath
    }
    else {
        $targetFullPath = Join-Path $projectRoot $relPath
    }
    
    if (-not (Test-Path -LiteralPath $targetFullPath)) {
        Write-Warning "Target path not found: $targetFullPath (Name: $name). Skipping."
        $failCount++
        continue
    }
    $targetFullPath = (Resolve-Path -LiteralPath $targetFullPath).Path

    # 出力ファイル名
    $outFile = Join-Path $OutDir "${timestamp}_${name}.md"
    if (-not (Split-Path $outFile -IsAbsolute)) {
        $outFile = Join-Path $scriptRoot $outFile
    }

    Write-Log "Processing target: [$name] -> $relPath" "Cyan"
    
    try {
        # RepoDump.ps1 呼び出し
        $params = @{
            RootPath     = $targetFullPath
            OutPath      = $outFile
            UseGitignore = $true
        }

        # サブプロセスで実行
        & $repoDumpPath.Path @params | Out-Null

        if ($LASTEXITCODE -eq 0 -and (Test-Path $outFile)) {
            Write-Log "  -> Success: $outFile" "Gray"
            $successCount++
        }
        else {
            Write-Log "  -> Failed (ExitCode: $LASTEXITCODE)" "Red"
            $failCount++
        }
    }
    catch {
        Write-Log "  -> Error: $_" "Red"
        $failCount++
    }
}

# -------------------------------------------------------------
# 完了
# -------------------------------------------------------------
Write-Host ""
Write-Log "Batch dump completed." "Green"
Write-Log "Success: $successCount, Failed: $failCount" $(if ($failCount -gt 0) { "Red" }else { "Green" })
===== END FILE: workspace.example/BatchDump.ps1 =====

===== BEGIN FILE: workspace.example/workspace.json | lang=json =====
{
  "Targets": [
    {
      "Name": "This Repository",
      "Path": "."
    },
    {
      "Name": "workspace.example",
      "Path": "workspace.example"
    }
  ]
}
===== END FILE: workspace.example/workspace.json =====

